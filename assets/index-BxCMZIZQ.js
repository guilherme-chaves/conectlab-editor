var se=Object.defineProperty;var ne=(s,t,e)=>t in s?se(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var l=(s,t,e)=>ne(s,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();var x=(s=>(s[s.LINE=1]="LINE",s[s.NODE=2]="NODE",s[s.TEXT=3]="TEXT",s[s.SLOT=4]="SLOT",s[s.INPUT=5]="INPUT",s[s.OUTPUT=6]="OUTPUT",s))(x||{}),v=(s=>(s[s.G_AND=0]="G_AND",s[s.G_NAND=1]="G_NAND",s[s.G_NOR=2]="G_NOR",s[s.G_NOT=3]="G_NOT",s[s.G_OR=4]="G_OR",s[s.G_XNOR=5]="G_XNOR",s[s.G_XOR=6]="G_XOR",s[s.I_SWITCH=100]="I_SWITCH",s[s.O_LED_RED=200]="O_LED_RED",s))(v||{});const ie="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='64'%20height='64'%20version='1.1'%20viewBox='0%200%2016%2016'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20fill='none'%20stroke='%23289fac'%20stroke-linejoin='round'%20stroke-opacity='.5'%20stroke-width='.3'%3e%3cpath%20d='m0%2010.82h16'/%3e%3cpath%20d='m0%205.482h16'/%3e%3cpath%20d='m0%200.0675h16'/%3e%3cpath%20d='m10.82%200v16'/%3e%3cpath%20d='m16.06%200v16'/%3e%3cpath%20d='m0.0675%200v16'/%3e%3cpath%20d='m5.482%200v16'/%3e%3cpath%20d='m0%2016.06h16'/%3e%3c/g%3e%3c/svg%3e",oe=["connections","nodes","slots","texts"];function Ht(s){s.save(),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,s.canvas.width,s.canvas.height),s.restore()}function re(s,t){Ht(s);for(const e of oe)for(const n of t[e].values())n.draw(s)}function ae(s,t){Ht(s),s.rect(0,0,s.canvas.width,s.canvas.height),s.fillStyle=t??"#ff0000",s.fill()}const le=s=>s[0],ce=s=>s[0]&&s[1],he=s=>!(s[0]&&s[1]),de=s=>!(s[0]||s[1]),ue=s=>!s[0],fe=s=>s[0]||s[1],ge=s=>s[0]===s[1],me=s=>s[0]!==s[1],st={input_output:le,and:ce,nand:he,nor:de,not:ue,or:fe,xnor:ge,xor:me},gt={updateGraph(s){const t=new Set;for(const e of Object.keys(s))this.updateVertexStatus(s,parseInt(e),t);t.clear()},updateGraphPartial(s,t){var i;const e=new Set,n=[t];do e.has(n[0])||(e.add(n[0]),n.push(...((i=s[n[0]])==null?void 0:i.signalTo)??[]),n[0]!==t&&s[n[0]].nodeType!==v.I_SWITCH&&this.computeState(s,s[n[0]])),n.shift();while(n.length>0)},updateVertexStatus(s,t,e){if(e.has(t))return;e.add(t);const n=s[t];if(n!==void 0){for(let i=0;i<n.signalFrom.length;i++)this.updateVertexStatus(s,n.signalFrom[i],e);n.nodeType!==v.I_SWITCH&&this.computeState(s,n)}},computeState(s,t){var i,o;const e=this.getComputeFunction(t.nodeType),n=[!1,!1];n[0]=((i=s[t.signalFrom[0]])==null?void 0:i.state)??!1,n[1]=((o=s[t.signalFrom[1]])==null?void 0:o.state)??!1,t.state=e(n)},getComputeFunction(s){switch(s){case v.G_AND:return st.and;case v.G_NAND:return st.nand;case v.G_NOR:return st.nor;case v.G_NOT:return st.not;case v.G_OR:return st.or;case v.G_XNOR:return st.xnor;case v.G_XOR:return st.xor;default:return st.input_output}}},Ct={addVertex(s,t,e,n,i=[],o=[]){s[t]||(s[t]={state:n,signalFrom:i,signalTo:o,nodeType:e},gt.updateGraph(s))},removeVertex(s,t){var e;if(s[t]){for(const n of Object.values(s[t].signalTo)){const i=((e=s[n])==null?void 0:e.signalFrom.indexOf(t))??-1;i!==-1&&(s[n].signalFrom.splice(i,1),s[n].state=void 0)}delete s[t],gt.updateGraph(s)}},addEdge(s,t){var i,o;const e=((i=t.connectedTo.start)==null?void 0:i.nodeId)??-1,n=((o=t.connectedTo.end)==null?void 0:o.nodeId)??-1;s[e]?s[e].signalTo.find(r=>n===r)===void 0&&s[e].signalTo.push(n):console.warn(`Node inicial com ID ${n} não encontrado no grafo de sinal, isso poderá acarretar em bugs`,t),s[n]?s[n].signalFrom.push(e):console.warn(`Node final com ID ${n} não encontrado no grafo de sinal, isso poderá acarretar em bugs`,t),gt.updateGraph(s)},removeEdge(s,t){var i,o,r,a;if(t===void 0)return;const e=((i=t.connectedTo.start)==null?void 0:i.nodeId)??-1,n=((o=t.connectedTo.end)==null?void 0:o.nodeId)??-1;if(n!==-1){const h=((r=s[n])==null?void 0:r.signalFrom.indexOf(e))??-1;h!==-1&&s[n].signalFrom.splice(h,1)}if(e!==-1){const h=((a=s[e])==null?void 0:a.signalTo.indexOf(n))??-1;h!==-1&&s[e].signalTo.splice(h,1)}gt.updateGraph(s)},getVertexState(s,t){var e;return((e=s[t])==null?void 0:e.state)??!1},setVertexState(s,t,e){s[t]&&(s[t].state=e)},getVertexConnections(s,t){var e;return((e=s[t])==null?void 0:e.signalFrom)??[]}};function ve(s,t){const e=s.nodes.get(t);if(e===void 0)return!1;Ct.removeVertex(s.signalGraph,t);for(let n=0;n<e.slots.length;n++)s.removeComponent(e.slots[n].id,x.SLOT);return s.nodes.delete(t)}function pe(s,t){const e=s.slots.get(t);if(e===void 0)return!1;for(const n of Object.values(e.slotConnections))s.removeComponent(n.id,x.LINE);return s.slots.delete(t)}function ye(s,t){var o,r;const e=s.connections.get(t);if(e===void 0)return!1;const n=s.slots.get(((o=e.connectedTo.start)==null?void 0:o.slotId)??-1),i=s.slots.get(((r=e.connectedTo.end)==null?void 0:r.slotId)??-1);if(n){const a=n.slotConnections.findIndex(h=>h.id===t);a!==-1&&n.slotConnections.splice(a,1)}if(i){const a=i.slotConnections.findIndex(h=>h.id===t);a!==-1&&i.slotConnections.splice(a,1)}return Ct.removeEdge(s.signalGraph,e),s.connections.delete(t)}function we(s,t){return s.texts.delete(t)}const w=class w{constructor(t=0,e=0,n=!0){l(this,"_x",0);l(this,"_y",0);l(this,"useInt");this.useInt=n,typeof t=="number"?(this.x=t,this.y=e):typeof t=="object"&&(this.x=t.x,this.y=t.y)}get x(){return this._x}set x(t){this._x=this.useInt?Math.round(t):t}get y(){return this._y}set y(t){this._y=this.useInt?Math.round(t):t}add(t){return this.x+=t.x,this.y+=t.y,this}static add(t,e,n,i=!0){return n??(n=new w(0,0,i)),n.x=t.x+e.x,n.y=t.y+e.y,n}sub(t){return this.x-=t.x,this.y-=t.y,this}static sub(t,e,n,i=!0){return n??(n=new w(0,0,i)),n.x=t.x-e.x,n.y=t.y-e.y,n}mul(t){return t instanceof w?(this.x*=t.x,this.y*=t.y):(this.x*=t,this.y*=t),this}static mul(t,e,n,i=!0){return n??(n=new w(0,0,i)),e instanceof w?(n.x=t.x*e.x,n.y=t.y*e.y):(n.x=t.x*e,n.y=t.y*e),n}div(t){return t instanceof w?(this.x/=t.x,this.y/=t.y):(this.x/=t,this.y/=t),this}static div(t,e,n,i=!0){return n??(n=new w(0,0,i)),e instanceof w?(n.x=t.x/e.x,n.y=t.y/e.y):(n.x=t.x/e,n.y=t.y/e),n}dot(t){return this.x*t.x+this.y*t.y}static dot(t,e){return t.x*e.x+t.y*e.y}cross(t){return this.x*t.y-this.y*t.x}static cross(t,e){return t.x*e.y-t.y*e.x}len(){return Math.sqrt(this.lenSquared())}static len(t){return Math.sqrt(w.lenSquared(t))}lenSquared(){return this.dot(this)}static lenSquared(t){return w.dot(t,t)}madd(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}static madd(t,e,n,i,o=!0){return i??(i=new w(0,0,o)),i.x=t.x+e.x*n,i.y=t.y+e.y*n,i}lerp(t,e){return this.madd(t.sub(this),e)}static lerp(t,e,n,i,o=!0){return w.madd(t,w.sub(e,t),n,i,o)}bilinear(t,e){return this.x=w.lerp(this,t,e.x).x,this.y=w.lerp(this,t,e.y).y,this}static bilinear(t,e,n,i,o=!0){return i??(i=new w(0,0,o)),i.x=w.lerp(t,e,n.x,void 0,o).x,i.y=w.lerp(t,e,n.y,void 0,o).y,i}equals(t,e=1e-4){return this.useInt&&t.useInt?this.x===t.x&&this.y===t.y:Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e}static equals(t,e,n=1e-4){return t.useInt&&e.useInt?t.x===e.x&&t.y===e.y:Math.abs(t.x-e.x)<n&&Math.abs(t.y-e.y)<n}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}static min(t,e,n,i=!0){return n??(n=new w(0,0,i)),n.x=Math.min(t.x,e.x),n.y=Math.min(t.y,e.y),n}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}static max(t,e,n,i=!0){return n??(n=new w(0,0,i)),n.x=Math.max(t.x,e.x),n.y=Math.max(t.y,e.y),n}rotate(t){const e=Math.sin(t),n=Math.cos(t);return this.x=this.x*n-this.y*e,this.y=this.x*e+this.y*n,this}static rotate(t,e,n,i=!0){n??(n=new w(0,0,i));const o=Math.sin(e),r=Math.cos(e);return n.x=t.x*r-t.y*o,n.y=t.x*o+t.y*r,n}angleBetween(t){return Math.atan2(t.y-this.y,t.x-this.x)}static angleBetween(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}normalize(){return this.useInt=!1,this.div(this.len())}static normalize(t,e,n=!1){return w.div(t,t.len(),e,n)}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}static abs(t,e,n=!0){return e??(e=new w(0,0,n)),e.x=Math.abs(t.x),e.y=Math.abs(t.y),e}copy(){return new w(this,void 0,this.useInt)}static copy(t,e){return e.useInt=t.useInt,e.x=t.x,e.y=t.y,e}toPlainObject(){return{x:this.x,y:this.y,useInt:this.useInt}}};l(w,"ZERO",new w);let c=w;class jt{constructor(t,e=2,n=2,i="#FF8008DC"){l(this,"position");l(this,"points");l(this,"globalPoints");l(this,"width");l(this,"height");l(this,"drawPath");l(this,"regenPath");l(this,"borderColor");this.position=t,this.width=e,this.height=n,this.borderColor=i,this.points=this.setPoints(),this.regenPath=!1,this.globalPoints={a:this.position,b:c.add(this.position,this.points.b)}}setGlobalPoints(){c.add(this.position,this.points.b,this.globalPoints.b)}setPoints(){return{a:c.ZERO,b:new c(this.width,this.height)}}generatePath(){const t=new Path2D;return t.rect(this.position.x,this.position.y,this.width,this.height),this.regenPath=!1,t}draw(t,e){e&&((!this.drawPath||this.regenPath)&&(this.drawPath=this.generatePath()),t.save(),t.strokeStyle=this.borderColor,t.stroke(this.drawPath),t.restore())}moveShape(t,e=!0){e?this.position.add(t):c.copy(t,this.position),this.setGlobalPoints(),this.regenPath=!0}collisionWithPoint(t){return t.x>this.globalPoints.a.x&&t.x<this.globalPoints.b.x&&t.y>this.globalPoints.a.y&&t.y<this.globalPoints.b.y}collisionWithBox(t){return!(this.globalPoints.b.x<t.globalPoints.a.x||this.globalPoints.b.y<t.globalPoints.a.y||this.globalPoints.a.x>t.globalPoints.b.x||this.globalPoints.a.y>t.globalPoints.b.y)}collisionWithCircle(t){return t.collisionWithBox(this)}}const wt=Math.PI*.25,xt=Math.PI*.75,Gt={setCollisionShapeSize(s,t,e=0,n=0,i=0,o=0,r=1e-4){return s.useInt&&t.useInt?new c(s.x===t.x?e:n,s.y===t.y?i:o):new c(Math.abs(s.x-t.x)<r?e:n,Math.abs(s.y-t.y)<r?i:o,!1)},generateAnchors(s,t){const e=[];let n=new c;const i=s.copy(),o=new c(2,1,!1);let r,a=0;for(;a<64;){const h=new c(0,0,!1),f=i.angleBetween(t);if(h.x=f<=wt&&f>=-wt?1:f>xt||f<-xt?-1:0,h.y=f>wt&&f<=xt?1:f<-wt&&f>=-xt?-1:0,e.length===0?r=h.abs().div(o):r=h.abs().div(o).add(n),c.bilinear(s,t,r,i),e.push(r),n=r.copy(),i.equals(t))break;a+=1}return e},generateCollisionShapes(s,t,e){if(e.length===0)return[];const n=[];let i=s.copy();const o=new c;for(let r=0;r<=e.length;r++){r<e.length?c.bilinear(s,t,e[r],o):c.copy(t,o);const a=this.setCollisionShapeSize(i,o,12,o.x-i.x,12,o.y-i.y);n.push(new jt(i.sub(new c(6,6)),a.x,a.y)),i=o.copy()}return n}};class xe{constructor(t,e,n,i={start:void 0,end:void 0},o){l(this,"id");l(this,"position");l(this,"componentType");l(this,"endPosition");l(this,"anchors");l(this,"connectedTo");l(this,"drawPath");l(this,"regenPath");l(this,"collisionShape");l(this,"selected");this.id=t,this.position=e,this.componentType=x.LINE,this.endPosition=n,this.anchors=o??[new c(.25,0),new c(.25,.5),new c(.5,.5),new c(.5,1)],this.connectedTo=i,this.regenPath=!0,this.collisionShape=this.generateCollisionShapes(),this.selected=!1}generatePath(){const t=new Path2D;t.moveTo(this.position.x,this.position.y);const e=new c;for(let n=0;n<this.anchors.length;n++)c.bilinear(this.position,this.endPosition,this.anchors[n],e),t.lineTo(e.x,e.y);return t.lineTo(this.endPosition.x,this.endPosition.y),this.regenPath=!1,t}generateCollisionShapes(){return Gt.generateCollisionShapes(this.position,this.endPosition,this.anchors)}generateAnchors(){return Gt.generateAnchors(this.position,this.endPosition)}draw(t){if(this.endPosition!==this.position){(this.regenPath||!this.drawPath)&&(this.drawPath=this.generatePath()),t.save(),t.strokeStyle="#101010",t.lineWidth=2,t.lineJoin="round",t.stroke(this.drawPath),t.restore();for(let e=0;e<this.collisionShape.length;e++)this.collisionShape[e].draw(t,this.selected)}}addAnchor(t,e=this.anchors.length){this.anchors.splice(e,0,t),this.regenPath=!0}removePoint(t=this.anchors.length-1){if(t<0||t>=this.anchors.length){console.error("ConnectionComponent.removePoint - index is out of bounds!");return}this.anchors.splice(t,1),this.regenPath=!0}move(t,e=!0,n=2,i=!0){e?(n!==1&&this.position.add(t),n!==0&&this.endPosition.add(t)):(n!==1&&c.copy(t,this.position),n!==0&&c.copy(t,this.endPosition)),this.anchors=this.generateAnchors(),i&&(this.collisionShape=this.generateCollisionShapes()),this.regenPath=!0}changeAnchor(t,e=this.anchors.length-1){if(e<0||e>=this.anchors.length){console.error("ConnectionComponent.changePosition - index is out of bounds!");return}this.anchors[e]=c.sub(t,this.position,void 0,!1).div(c.sub(this.endPosition,this.position,void 0,!1)),this.regenPath=!0}changeConnection(t,e,n=!1){t!==void 0&&e!==void 0?n?this.connectedTo.end={slotId:t,nodeId:e}:this.connectedTo.start={slotId:t,nodeId:e}:n?this.connectedTo.end=void 0:this.connectedTo.start=void 0}toObject(){const t={id:this.id,componentType:this.componentType,position:this.position.toPlainObject(),endPosition:this.endPosition.toPlainObject(),anchors:[],connectedTo:this.connectedTo};return this.anchors.forEach(e=>t.anchors.push(e.toPlainObject())),t}}const Pe={id:v.G_AND,imgPath:["/src/assets/gates/AND_ANSI.svg"],connectionSlot:[{id:0,name:"A",in:!0,localPos:new c(0,15)},{id:1,name:"B",in:!0,localPos:new c(0,35)},{id:2,name:"C",in:!1,localPos:new c(88,25)}]},be={id:v.G_NAND,imgPath:["/src/assets/gates/NAND_ANSI.svg"],connectionSlot:[{id:0,name:"A",in:!0,localPos:new c(0,15)},{id:1,name:"B",in:!0,localPos:new c(0,35)},{id:2,name:"C",in:!1,localPos:new c(88,25)}]},Ce={id:v.G_NOR,imgPath:["/src/assets/gates/NOR_ANSI.svg"],connectionSlot:[{id:0,name:"A",in:!0,localPos:new c(0,15)},{id:1,name:"B",in:!0,localPos:new c(0,35)},{id:2,name:"C",in:!1,localPos:new c(88,25)}]},_e={id:v.G_NOT,imgPath:["/src/assets/gates/NOT_ANSI.svg"],connectionSlot:[{id:0,name:"In",in:!0,localPos:new c(0,25)},{id:1,name:"Out",in:!1,localPos:new c(88,25)}]},Se={id:v.G_OR,imgPath:["/src/assets/gates/OR_ANSI.svg"],connectionSlot:[{id:0,name:"A",in:!0,localPos:new c(0,15)},{id:1,name:"B",in:!0,localPos:new c(0,35)},{id:2,name:"C",in:!1,localPos:new c(88,25)}]},Ie={id:v.G_XNOR,imgPath:["/src/assets/gates/XNOR_ANSI.svg"],connectionSlot:[{id:0,name:"A",in:!0,localPos:new c(0,15)},{id:1,name:"B",in:!0,localPos:new c(0,35)},{id:2,name:"C",in:!1,localPos:new c(88,25)}]},Oe={id:v.G_XOR,imgPath:["/src/assets/gates/XOR_ANSI.svg"],connectionSlot:[{id:0,name:"A",in:!0,localPos:new c(0,15)},{id:1,name:"B",in:!0,localPos:new c(0,35)},{id:2,name:"C",in:!1,localPos:new c(88,25)}]},nt={ADDNode:Pe,NANDNode:be,NORNode:Ce,NOTNode:_e,ORNode:Se,XNORNode:Ie,XORNode:Oe},ke={id:v.I_SWITCH,imgPath:["/src/assets/gates/INPUT_OFF.svg","/src/assets/gates/INPUT_ON.svg"],connectionSlot:[{id:0,in:!1,name:"A",localPos:new c(70,25)}]},Te={id:v.O_LED_RED,imgPath:["/src/assets/gates/LED_OFF.svg","/src/assets/gates/LED_RED_ON.svg"],connectionSlot:[{id:0,in:!0,name:"A",localPos:new c(23,64)}]};async function Ne(s){const t=new Image;return t.src=s,await t.decode(),window.createImageBitmap(t)}function Le(s,t){const e={};let n=0;for(const i of t)Object.keys(s).includes(i)&&(e[n]=s[i],n++);return e}class bt{constructor(t,e,n,i,o,r,a,h,f,u=!0){l(this,"id");l(this,"position");l(this,"componentType");l(this,"nodeType");l(this,"slots");l(this,"collisionShape");l(this,"_images");l(this,"imageWidth");l(this,"imageHeight");l(this,"_signalData");l(this,"selected");var d,g;if(this.id=t,this.position=e,this.componentType=n,this.nodeType=bt.getNodeModel(i),this._signalData=f[this.id],this.slots=a,this._images=Le(h,this.nodeType.imgPath),this.imageWidth=((d=this.image)==null?void 0:d.width)??100,this.imageHeight=((g=this.image)==null?void 0:g.height)??100,u){this.position.sub(new c(this.imageWidth/2,this.imageHeight/2));const p=new c(o,r).sub(new c(this.imageWidth,this.imageHeight));this.position.min(p).max(c.ZERO)}this.collisionShape=new jt(this.position,this.imageWidth,this.imageHeight),this.selected=!1}get image(){return Object.keys(this._images).length===0?null:this.componentType===x.NODE?this._images[0]:this._images[this.state?1:0]}get state(){return this._signalData.state??!1}set state(t){this._signalData.state=t}static getNodeModel(t){switch(t){case v.G_AND:return nt.ADDNode;case v.G_NAND:return nt.NANDNode;case v.G_NOR:return nt.NORNode;case v.G_NOT:return nt.NOTNode;case v.G_OR:return nt.ORNode;case v.G_XNOR:return nt.XNORNode;case v.G_XOR:return nt.XORNode;case v.I_SWITCH:return ke;case v.O_LED_RED:return Te;default:return nt.NOTNode}}move(t,e=!0){e?(this.position.add(t),this.collisionShape.moveShape(this.position,!1)):(c.sub(t,new c(this.imageWidth/2,this.imageHeight/2),this.position),this.collisionShape.moveShape(this.position,!1))}draw(t){this.image&&(t.drawImage(this.image,this.position.x,this.position.y),this.collisionShape!==void 0&&this.collisionShape.draw(t,this.selected))}toObject(){return{id:this.id,componentType:this.componentType,nodeType:this.nodeType.id,position:this.position.toPlainObject(),slotIds:this.slots.map(e=>e.id),state:this.state}}}class Ae{constructor(t,e,n="#FF8008DC"){l(this,"position");l(this,"radius");l(this,"radiusSquared");l(this,"drawPath");l(this,"regenPath");l(this,"borderColor");this.position=t,this.radius=e,this.radiusSquared=e*e,this.borderColor=n,this.regenPath=!1}generatePath(){const t=new Path2D;return t.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2),this.regenPath=!1,t}draw(t,e){e&&((!this.drawPath||this.regenPath)&&(this.drawPath=this.generatePath()),t.save(),t.strokeStyle=this.borderColor,t.stroke(this.drawPath),t.restore())}moveShape(t,e=!0){e?this.position.add(t):c.copy(t,this.position),this.drawPath=this.generatePath()}collisionWithPoint(t){return c.sub(this.position,t).lenSquared()<this.radiusSquared}collisionWithBox(t){let e=0;return this.position.x<t.globalPoints.b.x?e+=Math.pow(t.globalPoints.b.x-this.position.x,2):this.position.x>t.globalPoints.a.x&&(e+=Math.pow(this.position.x-t.globalPoints.a.x,2)),this.position.y<t.globalPoints.b.y?e+=Math.pow(t.globalPoints.b.y-this.position.y,2):this.position.y>t.globalPoints.a.y&&(e+=Math.pow(this.position.y-t.globalPoints.a.y,2)),e<this.radiusSquared}collisionWithCircle(t){return c.sub(this.position,t.position).len()<this.radius+t.radius}}class Ee{constructor(t,e,n,i=[],o=!0,r=4,a=12,h="#0880FF",f="#FF0000"){l(this,"id");l(this,"position");l(this,"globalPosition");l(this,"componentType");l(this,"parent");l(this,"_slotConnections");l(this,"drawPath");l(this,"regenPath");l(this,"selected");l(this,"inSlot");l(this,"color");l(this,"colorActive");l(this,"radius");l(this,"attractionRadius");l(this,"collisionShape");this.id=t,this.position=e,this.globalPosition=c.add(e,n.position),this.componentType=x.SLOT,this.parent=n,this._slotConnections=i,this.color=h,this.colorActive=f,this.selected=!1,this.inSlot=o,this.radius=r,this.attractionRadius=a,this.collisionShape=new Ae(this.globalPosition,this.attractionRadius),this.regenPath=!1}get slotConnections(){return this._slotConnections}set slotConnections(t){this.inSlot?(this._slotConnections.splice(0,this._slotConnections.length),this._slotConnections.push(t[0])):this._slotConnections=t}move(t,e=!0){c.add(this.position,this.parent.position,this.globalPosition),this.collisionShape.moveShape(this.globalPosition,!1),this.regenPath=!0}generatePath(){const t=new Path2D;return t.arc(this.globalPosition.x,this.globalPosition.y,this.radius,0,Math.PI*2),t}draw(t){(!this.drawPath||this.regenPath)&&(this.drawPath=this.generatePath()),t.save(),t.fillStyle=this.selected?this.colorActive:this.color,t.fill(this.drawPath),t.restore(),this.collisionShape.draw(t,this.selected)}toObject(){return{id:this.id,componentType:this.componentType,position:this.position.toPlainObject(),parentId:this.parent.id,connectionIds:this.slotConnections.map(e=>e.id),inSlot:this.inSlot,color:this.color,colorActive:this.colorActive,radius:this.radius,attractionRadius:this.attractionRadius}}}class Re{constructor(t,e,n="",i="12px sans-serif",o,r){l(this,"id");l(this,"position");l(this,"componentType");l(this,"text");l(this,"parent");l(this,"style");l(this,"textSize");l(this,"collisionShape");l(this,"canvasContext");l(this,"selected");this.id=t,this.position=e,this.componentType=x.TEXT,this.text=n,this.style=i,this.parent=o,this.canvasContext=r,this.textSize=this.measureText(n,i),this.position.sub(c.div(this.textSize,2)),this.collisionShape=new jt(this.position,this.textSize.x,this.textSize.y),this.selected=!1}measureText(t,e){this.canvasContext.font=e,this.canvasContext.textBaseline="top",this.canvasContext.textAlign="left";const n=this.canvasContext.measureText(t);return new c(n.width,n.actualBoundingBoxDescent-n.actualBoundingBoxAscent).max(new c(16,16))}draw(t){t.save(),t.font=this.style,t.textBaseline="top",t.textAlign="left",t.fillText(this.text,this.position.x,this.position.y),t.restore(),this.collisionShape.draw(t,this.selected)}move(t,e=!0){e?this.position.add(t):c.sub(t,c.div(this.textSize,2),this.position),this.collisionShape.moveShape(this.position,!1)}toObject(){return{id:this.id,componentType:this.componentType,position:this.position.toPlainObject(),text:this.text,parent:this.parent,style:this.style}}}const J={node(s=-1,t,e,n,i,o,r,a=x.NODE,h=[],f=!0,u=!1){const d=s>=0?s:t.nextComponentId;Ct.addVertex(t.signalGraph,d,i,u),(a===x.LINE||a===x.SLOT||a===x.TEXT)&&(a=x.NODE);let g=new bt(d,new c(o,r),a,i,e,n,[],t.nodeImageList,t.signalGraph,f);if(t.nodes.set(d,g),g=t.nodes.get(d),t.updateComponentId(s>=0?s:void 0),h.length===0){const p=bt.getNodeModel(i).connectionSlot;for(const C of Object.values(p)){const P=this.slot(void 0,t,C.localPos.x,C.localPos.y,g,C.in);if(!g.slots.find(I=>I.id===P)){const I=t.slots.get(P);I&&g.slots.push(I)}}}else for(const p of h){const C=t.slots.get(p);C&&g.slots.push(C)}return d},input(s=-1,t,e,n,i,o,r,a,h=!0,f=!1){return this.node(s,t,e,n,i,o,r,x.INPUT,a,h,f)},output(s=-1,t,e,n,i,o,r,a,h=!0,f=!1){return this.node(s,t,e,n,i,o,r,x.OUTPUT,a,h,f)},slot(s=-1,t,e,n,i,o,r,a,h,f){const u=s>=0?s:t.nextComponentId,d=new Ee(u,new c(e,n),i,void 0,o,r,a,h,f);return t.slots.set(u,d),(i.componentType===x.INPUT||i.componentType===x.OUTPUT||i.componentType===x.NODE)&&i.slots.push(t.slots.get(u)),t.updateComponentId(s>=0?s:void 0)},connection(s=-1,t,e,n,i,o,r,a,h){const f=s>=0?s:t.nextComponentId,u=new xe(f,new c(e,n),new c(i,o),{start:r,end:a},h);return t.connections.set(f,u),t.updateComponentId(s>=0?s:void 0)},text(s=-1,t,e,n,i,o,r,a){const h=s>=0?s:t.nextComponentId,f=new Re(h,new c(i,o),n,r,a?{id:a.id,type:a.componentType}:null,e);return t.texts.set(h,f),t.updateComponentId(s>=0?s:void 0)}};class vt{constructor(t,e=0,n,i={},o=new Map,r=new Map,a=new Map,h=new Map){l(this,"documentId");l(this,"_nextComponentId");l(this,"nodes");l(this,"slots");l(this,"connections");l(this,"texts");l(this,"nodeImageList");l(this,"signalGraph");this.documentId=t,this._nextComponentId=e,this.nodes=o,this.slots=r,this.connections=a,this.texts=h,this.signalGraph=i,this.nodeImageList=n}getDocumentId(){return this.documentId}get components(){return{nodes:this.nodes,slots:this.slots,connections:this.connections,texts:this.texts}}get nextComponentId(){return this._nextComponentId}updateComponentId(t){const e=this._nextComponentId;return this._nextComponentId=t?Math.max(this._nextComponentId,t+1):this._nextComponentId+1,e}removeComponent(t=this._nextComponentId-1,e){if(e)switch(e){case x.NODE:case x.INPUT:case x.OUTPUT:return ve(this,t);case x.SLOT:return pe(this,t);case x.LINE:return ye(this,t);case x.TEXT:return we(this,t)}else{const n=this.connections.get(t)??this.nodes.get(t)??this.slots.get(t)??this.texts.get(t);if(n!==void 0)return this.removeComponent(n.id,n.componentType)}return!1}saveAsJson(){const t={id:this.documentId,data:{nodes:[],connections:[],slots:[],texts:[]},signal:{}};for(const[e,n]of Object.entries(this.components))for(const i of n.values())switch(e){case"nodes":t.data.nodes.push(i.toObject());break;case"slots":t.data.slots.push(i.toObject());break;case"connections":t.data.connections.push(i.toObject());break;case"texts":t.data.texts.push(i.toObject());break}return t.signal=this.signalGraph,JSON.stringify(t)}static createFromJson(t,e,n){const i=new vt(t.id,0,structuredClone(n),t.signal);for(const o of t.data.nodes)J.node(o.id,i,e.canvas.width,e.canvas.height,o.nodeType,o.position.x,o.position.y,o.componentType,o.slotIds,!1);for(const o of t.data.slots)J.slot(o.id,i,o.position.x,o.position.y,i.nodes.get(o.parentId),o.inSlot,o.radius,o.attractionRadius,o.color,o.colorActive);for(const o of t.data.connections)J.connection(o.id,i,o.position.x,o.position.y,o.endPosition.x,o.endPosition.y,o.connectedTo.start,o.connectedTo.end,o.anchors.map(r=>new c(r.x,r.y,r.useInt))),o.connectedTo.start&&i.slots.get(o.connectedTo.start.slotId).slotConnections.push(i.connections.get(o.id)),o.connectedTo.end&&i.slots.get(o.connectedTo.end.slotId).slotConnections.push(i.connections.get(o.id));for(const o of t.data.texts){J.text(o.id,i,e,o.text,o.position.x,o.position.y,o.style);break}return i}}const Ft={checkComponentClick(s,t){const e=[];for(const[n,i]of t.entries())i.collisionShape.collisionWithPoint(s)&&e.push(n);return e}},Lt={checkSlotClick(s,t){return Ft.checkComponentClick(t,s)}},Pt={editingLineId:-1,editingLine:!1,lineStartSlot:-1,oldSlotCollision:-1,slotCollision:-1,checkConnectionClick(s,t){const e=[];for(const[n,i]of s.entries())i.collisionShape.find(r=>r.collisionWithPoint(t))!==void 0&&e.push(n);return e},addLine(s,t){if(this.editingLine&&this.editingLineId!==-1)return!0;const e=t.getCollisionList().slots;if(e.length>0){const n=s.slots.get(e[0]);return n?(this.editingLineId=J.connection(void 0,s,n.globalPosition.x,n.globalPosition.y,n.globalPosition.x,n.globalPosition.y,{slotId:n.id,nodeId:n.parent.id}),this.editingLine=!0,this.oldSlotCollision=this.slotCollision,this.slotCollision=n.id,this.lineStartSlot=n.id,!0):!1}else this.oldSlotCollision=this.slotCollision,this.slotCollision=-1;return!1},move(s,t,e){if(!this.editingLine||this.editingLineId===-1||!(t.movingObject==="none"||t.movingObject==="connection")||!s.connections.has(this.editingLineId))return!1;t.movingObject="connection";const n=s.connections.get(this.editingLineId);return n?(n.move(e,!1,1,!1),this.bindConnection(s,e),!0):!1},fixLine(s,t){if(this.editingLine&&this.editingLineId!==-1){const e=Lt.checkSlotClick(s.slots,t);if(this.slotCollision!==-1&&e.length>0&&e[0]!==this.lineStartSlot){let n=s.slots.get(this.lineStartSlot),i=s.slots.get(e[0]);const o=s.connections.get(this.editingLineId);if(n.inSlot===i.inSlot)return s.removeComponent(this.editingLineId,x.LINE),this.resetConnEventParams(),!1;if(!i.inSlot){const r=this.lineStartSlot,a=n;this.lineStartSlot=e[0],n=i,e[0]=r,i=a}return this.removeOldInSlotConnection(s,n),this.removeOldInSlotConnection(s,i),n.slotConnections=[...n.slotConnections,o],i.slotConnections=[...i.slotConnections,o],this.changeConnectionParams(s.connections.get(this.editingLineId),n.globalPosition,i.globalPosition,this.lineStartSlot,n.parent.id,e[0],i.parent.id),Ct.addEdge(s.signalGraph,o),o.collisionShape=o.generateCollisionShapes(),this.resetConnEventParams(),!0}else return s.removeComponent(this.editingLineId,x.LINE),this.resetConnEventParams(),!1}return this.resetConnEventParams(),!1},bindConnection(s,t){var e;if(this.editingLine&&this.editingLineId!==-1){const n=Lt.checkSlotClick(s.slots,t),i=s.connections.get(this.editingLineId);if(n.length>0){if(((e=i.connectedTo.start)==null?void 0:e.slotId)!==n[0]){const o=s.slots.get(n[0]);this.oldSlotCollision=this.slotCollision,this.slotCollision=n[0],i.endPosition=new c(o.globalPosition)}}else this.slotCollision!==-1&&(this.oldSlotCollision=this.slotCollision,this.slotCollision=-1),i.endPosition=t}},changeConnectionParams(s,t,e,n,i,o,r){t!==void 0&&s.move(t,!1,0,!1),e!==void 0&&s.move(e,!1,1,!1),n!==void 0&&i!==void 0&&s.changeConnection(n,i,!1),o!==void 0&&r!==void 0&&s.changeConnection(o,r,!0)},removeOldInSlotConnection(s,t){if(!t.inSlot)return;const e=t.slotConnections[0];e!==void 0&&(t.slotConnections.splice(0,t.slotConnections.length),e.connectedTo.start&&s.slots.get(e.connectedTo.start.slotId).slotConnections.find((n,i,o)=>{var r;return n.id===((r=e.connectedTo.start)==null?void 0:r.slotId)?(o.splice(i,1),!0):!1}),e.connectedTo.end&&s.slots.get(e.connectedTo.end.slotId).slotConnections.find((n,i,o)=>{var r;return n.id===((r=e.connectedTo.end)==null?void 0:r.slotId)?(o.splice(i,1),!0):!1}),s.removeComponent(e.id,x.LINE))},resetConnEventParams(){this.editingLine=!1,this.editingLineId=-1,this.slotCollision=-1,this.oldSlotCollision=-1,this.lineStartSlot=-1}},Ot={checkNodeClick(s,t){return Ft.checkComponentClick(t,s)},move(s,t,e,n=!0){const i=t.getCollisionList().nodes;if(i.length===0||!(t.movingObject==="none"||t.movingObject==="node"))return!1;t.movingObject="node";const o=s.nodes.get(i[0]);return o===void 0?!1:(o.move(e,n),this.moveLinkedElements(o,n),!0)},moveLinkedElements(s,t=!0){var e,n;for(const i of s.slots)if(i){i.move();for(let o=0;o<i.slotConnections.length;o++){const r=i.slotConnections[o];((e=r.connectedTo.start)==null?void 0:e.slotId)===i.id?r.move(i.globalPosition,t,0):((n=r.connectedTo.end)==null?void 0:n.slotId)===i.id&&r.move(i.globalPosition,t,1)}}},switchInputState(s,t){const e=s.get(t);return e&&e.componentType===x.INPUT?(e.state=!e.state,!0):!1}},zt={checkTextClick(s,t){return Ft.checkComponentClick(t,s)},move(s,t,e,n=!0){const i=t.getCollisionList().texts;if(i.length===0||!(t.movingObject==="none"||t.movingObject==="text"))return!1;t.movingObject="text";const o=s.get(i[0]);return o===void 0?!1:(o.move(e,n),!0)}};class De{constructor(t){l(this,"collisionList");l(this,"_mouse");l(this,"movingObject");this._mouse=t,this.collisionList={nodes:[],slots:[],connections:[],texts:[]},this.movingObject="none"}onMouseClick(t){if(this._mouse.stateChanged&&this._mouse.clicked){this.clearAllCollisions(t);const e=Ot.checkNodeClick(t.nodes,this._mouse.position),n=Lt.checkSlotClick(t.slots,this._mouse.position),i=Pt.checkConnectionClick(t.connections,this._mouse.position),o=zt.checkTextClick(t.texts,this._mouse.position);this.clearUnselectedComponents(t,e,n,i,o),this.collisionList={nodes:e,slots:n,connections:i,texts:o},Pt.addLine(t,this),this.showSelectedComponents(t),this._mouse.stateChanged=!1}}onMouseRelease(t){!this._mouse.clicked&&this._mouse.stateChanged&&(this._mouse.dragged||this.collisionList.nodes.length!==0&&Ot.switchInputState(t.nodes,this.collisionList.nodes[0])&&gt.updateGraphPartial(t.signalGraph,this.collisionList.nodes[0]),Pt.fixLine(t,this._mouse.position),this._mouse.stateChanged=!1),this.movingObject="none"}onMouseMove(t){return this._mouse.clicked&&this._mouse.dragged?Pt.move(t,this,this._mouse.position)||Ot.move(t,this,this._mouse.position,!1)||zt.move(t.texts,this,this._mouse.position,!1):!1}showSelectedComponents(t){for(const[e,n]of Object.entries(this.collisionList))switch(e){case"slots":const i=t.slots.get(n[0]);i&&(i.selected=!0);break;case"nodes":const o=t.nodes.get(n[0]);o&&(o.selected=!0);break;case"texts":const r=t.texts.get(n[0]);r&&(r.selected=!0);break;case"connections":const a=t.connections.get(n[0]);a&&(a.selected=!0);break}}clearUnselectedComponents(t,e=[],n=[],i=[],o=[]){if(this.collisionList.nodes.length!==0){for(let r=0;r<this.collisionList.nodes.length;r++)if(!e.includes(this.collisionList.nodes[r])){const a=t.nodes.get(this.collisionList.nodes[r]);a&&(a.selected=!1)}}if(this.collisionList.slots.length!==0){for(let r=0;r<this.collisionList.slots.length;r++)if(!n.includes(this.collisionList.slots[r])){const a=t.slots.get(this.collisionList.slots[r]);a&&(a.selected=!1)}}if(this.collisionList.connections.length!==0){for(let r=0;r<this.collisionList.connections.length;r++)if(!i.includes(this.collisionList.connections[r])){const a=t.connections.get(this.collisionList.connections[r]);a&&(a.selected=!1)}}if(this.collisionList.texts.length!==0){for(let r=0;r<this.collisionList.texts.length;r++)if(!o.includes(this.collisionList.texts[r])){const a=t.texts.get(this.collisionList.texts[r]);a&&(a.selected=!1)}}}getCollisionList(){return this.collisionList}clearAllCollisions(t){this.clearUnselectedComponents(t),this.collisionList.nodes=[],this.collisionList.slots=[],this.collisionList.connections=[],this.collisionList.texts=[]}}class Me{constructor(){l(this,"position",new c);l(this,"_mouseClicked",!1);l(this,"doubleClicked",!1);l(this,"clickStartPosition",new c);l(this,"_mouseStateChanged",!1);l(this,"clickToDragThreshold",6);l(this,"doubleClickTimer",300);l(this,"alreadyClicked",!1)}get clicked(){return this._mouseClicked}set clicked(t){this._mouseClicked=t,this._mouseStateChanged=!0,t&&(this.clickStartPosition=this.position.copy())}get dragged(){const t=c.sub(this.position,this.clickStartPosition);return t.x>this.clickToDragThreshold||t.x<-this.clickToDragThreshold||t.y>this.clickToDragThreshold||t.y<-this.clickToDragThreshold}get stateChanged(){return this._mouseStateChanged}set stateChanged(t){this._mouseStateChanged=t,this.alreadyClicked?this.doubleClicked=this._mouseClicked:(this.alreadyClicked=!0,setTimeout(()=>this.alreadyClicked=!1,this.doubleClickTimer))}}var E=Uint8Array,X=Uint16Array,Bt=Int32Array,_t=new E([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),St=new E([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),At=new E([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Vt=function(s,t){for(var e=new X(31),n=0;n<31;++n)e[n]=t+=1<<s[n-1];for(var i=new Bt(e[30]),n=1;n<30;++n)for(var o=e[n];o<e[n+1];++o)i[o]=o-e[n]<<5|n;return{b:e,r:i}},$t=Vt(_t,2),Jt=$t.b,Et=$t.r;Jt[28]=258,Et[258]=28;var Qt=Vt(St,0),je=Qt.b,Wt=Qt.r,Rt=new X(32768);for(var b=0;b<32768;++b){var it=(b&43690)>>1|(b&21845)<<1;it=(it&52428)>>2|(it&13107)<<2,it=(it&61680)>>4|(it&3855)<<4,Rt[b]=((it&65280)>>8|(it&255)<<8)>>1}var Z=function(s,t,e){for(var n=s.length,i=0,o=new X(t);i<n;++i)s[i]&&++o[s[i]-1];var r=new X(t);for(i=1;i<t;++i)r[i]=r[i-1]+o[i-1]<<1;var a;if(e){a=new X(1<<t);var h=15-t;for(i=0;i<n;++i)if(s[i])for(var f=i<<4|s[i],u=t-s[i],d=r[s[i]-1]++<<u,g=d|(1<<u)-1;d<=g;++d)a[Rt[d]>>h]=f}else for(a=new X(n),i=0;i<n;++i)s[i]&&(a[i]=Rt[r[s[i]-1]++]>>15-s[i]);return a},ot=new E(288);for(var b=0;b<144;++b)ot[b]=8;for(var b=144;b<256;++b)ot[b]=9;for(var b=256;b<280;++b)ot[b]=7;for(var b=280;b<288;++b)ot[b]=8;var mt=new E(32);for(var b=0;b<32;++b)mt[b]=5;var Fe=Z(ot,9,0),Be=Z(ot,9,1),Ue=Z(mt,5,0),Ge=Z(mt,5,1),kt=function(s){for(var t=s[0],e=1;e<s.length;++e)s[e]>t&&(t=s[e]);return t},H=function(s,t,e){var n=t/8|0;return(s[n]|s[n+1]<<8)>>(t&7)&e},Tt=function(s,t){var e=t/8|0;return(s[e]|s[e+1]<<8|s[e+2]<<16)>>(t&7)},Ut=function(s){return(s+7)/8|0},Zt=function(s,t,e){return(e==null||e>s.length)&&(e=s.length),new E(s.subarray(t,e))},ze=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],$=function(s,t,e){var n=new Error(t||ze[s]);if(n.code=s,Error.captureStackTrace&&Error.captureStackTrace(n,$),!e)throw n;return n},We=function(s,t,e,n){var i=s.length,o=0;if(!i||t.f&&!t.l)return e||new E(0);var r=!e,a=r||t.i!=2,h=t.i;r&&(e=new E(i*3));var f=function(ht){var dt=e.length;if(ht>dt){var lt=new E(Math.max(dt*2,ht));lt.set(e),e=lt}},u=t.f||0,d=t.p||0,g=t.b||0,p=t.l,C=t.d,P=t.m,I=t.n,q=i*8;do{if(!p){u=H(s,d,1);var U=H(s,d+1,3);if(d+=3,U)if(U==1)p=Be,C=Ge,P=9,I=5;else if(U==2){var j=H(s,d,31)+257,T=H(s,d+10,15)+4,y=j+H(s,d+5,31)+1;d+=14;for(var m=new E(y),N=new E(19),O=0;O<T;++O)N[At[O]]=H(s,d+O*3,7);d+=T*3;for(var D=kt(N),et=(1<<D)-1,G=Z(N,D,1),O=0;O<y;){var F=G[H(s,d,et)];d+=F&15;var k=F>>4;if(k<16)m[O++]=k;else{var L=0,_=0;for(k==16?(_=3+H(s,d,3),d+=2,L=m[O-1]):k==17?(_=3+H(s,d,7),d+=3):k==18&&(_=11+H(s,d,127),d+=7);_--;)m[O++]=L}}var B=m.subarray(0,j),A=m.subarray(j);P=kt(B),I=kt(A),p=Z(B,P,1),C=Z(A,I,1)}else $(1);else{var k=Ut(d)+4,M=s[k-4]|s[k-3]<<8,R=k+M;if(R>i){h&&$(0);break}a&&f(g+M),e.set(s.subarray(k,R),g),t.b=g+=M,t.p=d=R*8,t.f=u;continue}if(d>q){h&&$(0);break}}a&&f(g+131072);for(var ct=(1<<P)-1,K=(1<<I)-1,Y=d;;Y=d){var L=p[Tt(s,d)&ct],z=L>>4;if(d+=L&15,d>q){h&&$(0);break}if(L||$(2),z<256)e[g++]=z;else if(z==256){Y=d,p=null;break}else{var W=z-254;if(z>264){var O=z-257,S=_t[O];W=H(s,d,(1<<S)-1)+Jt[O],d+=S}var Q=C[Tt(s,d)&K],rt=Q>>4;Q||$(3),d+=Q&15;var A=je[rt];if(rt>3){var S=St[rt];A+=Tt(s,d)&(1<<S)-1,d+=S}if(d>q){h&&$(0);break}a&&f(g+131072);var at=g+W;if(g<A){var pt=o-A,yt=Math.min(A,at);for(pt+g<0&&$(3);g<yt;++g)e[g]=n[pt+g]}for(;g<at;++g)e[g]=e[g-A]}}t.l=p,t.p=Y,t.b=g,t.f=u,p&&(u=1,t.m=P,t.d=C,t.n=I)}while(!u);return g!=e.length&&r?Zt(e,0,g):e.subarray(0,g)},tt=function(s,t,e){e<<=t&7;var n=t/8|0;s[n]|=e,s[n+1]|=e>>8},ut=function(s,t,e){e<<=t&7;var n=t/8|0;s[n]|=e,s[n+1]|=e>>8,s[n+2]|=e>>16},Nt=function(s,t){for(var e=[],n=0;n<s.length;++n)s[n]&&e.push({s:n,f:s[n]});var i=e.length,o=e.slice();if(!i)return{t:te,l:0};if(i==1){var r=new E(e[0].s+1);return r[e[0].s]=1,{t:r,l:1}}e.sort(function(R,j){return R.f-j.f}),e.push({s:-1,f:25001});var a=e[0],h=e[1],f=0,u=1,d=2;for(e[0]={s:-1,f:a.f+h.f,l:a,r:h};u!=i-1;)a=e[e[f].f<e[d].f?f++:d++],h=e[f!=u&&e[f].f<e[d].f?f++:d++],e[u++]={s:-1,f:a.f+h.f,l:a,r:h};for(var g=o[0].s,n=1;n<i;++n)o[n].s>g&&(g=o[n].s);var p=new X(g+1),C=Dt(e[u-1],p,0);if(C>t){var n=0,P=0,I=C-t,q=1<<I;for(o.sort(function(j,T){return p[T.s]-p[j.s]||j.f-T.f});n<i;++n){var U=o[n].s;if(p[U]>t)P+=q-(1<<C-p[U]),p[U]=t;else break}for(P>>=I;P>0;){var k=o[n].s;p[k]<t?P-=1<<t-p[k]++-1:++n}for(;n>=0&&P;--n){var M=o[n].s;p[M]==t&&(--p[M],++P)}C=t}return{t:new E(p),l:C}},Dt=function(s,t,e){return s.s==-1?Math.max(Dt(s.l,t,e+1),Dt(s.r,t,e+1)):t[s.s]=e},Xt=function(s){for(var t=s.length;t&&!s[--t];);for(var e=new X(++t),n=0,i=s[0],o=1,r=function(h){e[n++]=h},a=1;a<=t;++a)if(s[a]==i&&a!=t)++o;else{if(!i&&o>2){for(;o>138;o-=138)r(32754);o>2&&(r(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(r(i),--o;o>6;o-=6)r(8304);o>2&&(r(o-3<<5|8208),o=0)}for(;o--;)r(i);o=1,i=s[a]}return{c:e.subarray(0,n),n:t}},ft=function(s,t){for(var e=0,n=0;n<t.length;++n)e+=s[n]*t[n];return e},Yt=function(s,t,e){var n=e.length,i=Ut(t+2);s[i]=n&255,s[i+1]=n>>8,s[i+2]=s[i]^255,s[i+3]=s[i+1]^255;for(var o=0;o<n;++o)s[i+o+4]=e[o];return(i+4+n)*8},Kt=function(s,t,e,n,i,o,r,a,h,f,u){tt(t,u++,e),++i[256];for(var d=Nt(i,15),g=d.t,p=d.l,C=Nt(o,15),P=C.t,I=C.l,q=Xt(g),U=q.c,k=q.n,M=Xt(P),R=M.c,j=M.n,T=new X(19),y=0;y<U.length;++y)++T[U[y]&31];for(var y=0;y<R.length;++y)++T[R[y]&31];for(var m=Nt(T,7),N=m.t,O=m.l,D=19;D>4&&!N[At[D-1]];--D);var et=f+5<<3,G=ft(i,ot)+ft(o,mt)+r,F=ft(i,g)+ft(o,P)+r+14+3*D+ft(T,N)+2*T[16]+3*T[17]+7*T[18];if(h>=0&&et<=G&&et<=F)return Yt(t,u,s.subarray(h,h+f));var L,_,B,A;if(tt(t,u,1+(F<G)),u+=2,F<G){L=Z(g,p,0),_=g,B=Z(P,I,0),A=P;var ct=Z(N,O,0);tt(t,u,k-257),tt(t,u+5,j-1),tt(t,u+10,D-4),u+=14;for(var y=0;y<D;++y)tt(t,u+3*y,N[At[y]]);u+=3*D;for(var K=[U,R],Y=0;Y<2;++Y)for(var z=K[Y],y=0;y<z.length;++y){var W=z[y]&31;tt(t,u,ct[W]),u+=N[W],W>15&&(tt(t,u,z[y]>>5&127),u+=z[y]>>12)}}else L=Fe,_=ot,B=Ue,A=mt;for(var y=0;y<a;++y){var S=n[y];if(S>255){var W=S>>18&31;ut(t,u,L[W+257]),u+=_[W+257],W>7&&(tt(t,u,S>>23&31),u+=_t[W]);var Q=S&31;ut(t,u,B[Q]),u+=A[Q],Q>3&&(ut(t,u,S>>5&8191),u+=St[Q])}else ut(t,u,L[S]),u+=_[S]}return ut(t,u,L[256]),u+_[256]},Xe=new Bt([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),te=new E(0),Ke=function(s,t,e,n,i,o){var r=o.z||s.length,a=new E(n+r+5*(1+Math.ceil(r/7e3))+i),h=a.subarray(n,a.length-i),f=o.l,u=(o.r||0)&7;if(t){u&&(h[0]=o.r>>3);for(var d=Xe[t-1],g=d>>13,p=d&8191,C=(1<<e)-1,P=o.p||new X(32768),I=o.h||new X(C+1),q=Math.ceil(e/3),U=2*q,k=function(It){return(s[It]^s[It+1]<<q^s[It+2]<<U)&C},M=new Bt(25e3),R=new X(288),j=new X(32),T=0,y=0,m=o.i||0,N=0,O=o.w||0,D=0;m+2<r;++m){var et=k(m),G=m&32767,F=I[et];if(P[G]=F,I[et]=G,O<=m){var L=r-m;if((T>7e3||N>24576)&&(L>423||!f)){u=Kt(s,h,0,M,R,j,y,N,D,m-D,u),N=T=y=0,D=m;for(var _=0;_<286;++_)R[_]=0;for(var _=0;_<30;++_)j[_]=0}var B=2,A=0,ct=p,K=G-F&32767;if(L>2&&et==k(m-K))for(var Y=Math.min(g,L)-1,z=Math.min(32767,m),W=Math.min(258,L);K<=z&&--ct&&G!=F;){if(s[m+B]==s[m+B-K]){for(var S=0;S<W&&s[m+S]==s[m+S-K];++S);if(S>B){if(B=S,A=K,S>Y)break;for(var Q=Math.min(K,S-2),rt=0,_=0;_<Q;++_){var at=m-K+_&32767,pt=P[at],yt=at-pt&32767;yt>rt&&(rt=yt,F=at)}}}G=F,F=P[G],K+=G-F&32767}if(A){M[N++]=268435456|Et[B]<<18|Wt[A];var ht=Et[B]&31,dt=Wt[A]&31;y+=_t[ht]+St[dt],++R[257+ht],++j[dt],O=m+B,++T}else M[N++]=s[m],++R[s[m]]}}for(m=Math.max(m,O);m<r;++m)M[N++]=s[m],++R[s[m]];u=Kt(s,h,f,M,R,j,y,N,D,m-D,u),f||(o.r=u&7|h[u/8|0]<<3,u-=7,o.h=I,o.p=P,o.i=m,o.w=O)}else{for(var m=o.w||0;m<r+f;m+=65535){var lt=m+65535;lt>=r&&(h[u/8|0]=f,lt=r),u=Yt(h,u+1,s.subarray(m,lt))}o.i=r}return Zt(a,0,n+Ut(u)+i)},qe=function(){for(var s=new Int32Array(256),t=0;t<256;++t){for(var e=t,n=9;--n;)e=(e&1&&-306674912)^e>>>1;s[t]=e}return s}(),He=function(){var s=-1;return{p:function(t){for(var e=s,n=0;n<t.length;++n)e=qe[e&255^t[n]]^e>>>8;s=e},d:function(){return~s}}},Ve=function(s,t,e,n,i){if(!i&&(i={l:1},t.dictionary)){var o=t.dictionary.subarray(-32768),r=new E(o.length+s.length);r.set(o),r.set(s,o.length),s=r,i.w=o.length}return Ke(s,t.level==null?6:t.level,t.mem==null?i.l?Math.ceil(Math.max(8,Math.min(13,Math.log(s.length)))*1.5):20:12+t.mem,e,n,i)},Mt=function(s,t,e){for(;e;++t)s[t]=e,e>>>=8},$e=function(s,t){var e=t.filename;if(s[0]=31,s[1]=139,s[2]=8,s[8]=t.level<2?4:t.level==9?2:0,s[9]=3,t.mtime!=0&&Mt(s,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),e){s[3]=8;for(var n=0;n<=e.length;++n)s[n+10]=e.charCodeAt(n)}},Je=function(s){(s[0]!=31||s[1]!=139||s[2]!=8)&&$(6,"invalid gzip data");var t=s[3],e=10;t&4&&(e+=(s[10]|s[11]<<8)+2);for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!s[e++]);return e+(t&2)},Qe=function(s){var t=s.length;return(s[t-4]|s[t-3]<<8|s[t-2]<<16|s[t-1]<<24)>>>0},Ze=function(s){return 10+(s.filename?s.filename.length+1:0)};function Ye(s,t){t||(t={});var e=He(),n=s.length;e.p(s);var i=Ve(s,t,Ze(t),8),o=i.length;return $e(i,t),Mt(i,o-8,e.d()),Mt(i,o-4,n),i}function ts(s,t){var e=Je(s);return e+8>s.length&&$(6,"invalid gzip data"),We(s.subarray(e,-8),{i:2},new E(Qe(s)),t)}var es=typeof TextDecoder<"u"&&new TextDecoder,ss=0;try{es.decode(te,{stream:!0}),ss=1}catch{}function ns(s,t,e){if(!e.target){console.error("Falha ao tentar carregar os dados da entrada de dados");return}const n=e.target;if(!n.files||!n.files[0])return;const i=new FileReader;i.readAsArrayBuffer(n.files[0]),i.onload=()=>{if(!i.result||typeof i.result=="string")return;const o=ts(new Uint8Array(i.result)),r=JSON.parse(new TextDecoder().decode(o));if(typeof r.id!="string"&&typeof r.data.nodes!="object"&&Number.isInteger(r.data.nodes.length)&&typeof r.data.connections!="object"&&Number.isInteger(r.data.connections.length)&&typeof r.data.slots!="object"&&Number.isInteger(r.data.slots.length)&&typeof r.data.texts!="object"&&Number.isInteger(r.data.texts.length)&&typeof r.signal!="object"){window.alert("Falha ao carregar projeto! Arquivo inválido ou corrompido."),console.error("Falha ao carregar projeto! Arquivo inválido ou corrompido.");return}s.editorEnv=vt.createFromJson(r,t,s.editorEnv.nodeImageList)}}function ee(s){const t=window.prompt("Salvar projeto como:",`${s.documentId}-${Date.now()}`);if(t===null)return;const e=document.createElement("a"),n=new TextEncoder().encode(s.saveAsJson()),i=Ye(n,{level:6});e.href=URL.createObjectURL(new Blob([i],{type:"application/gzip"})),e.download=`${t}.simulation`,e.click()}function is(s){return confirm(`Deseja limpar o editor?
Qualquer progresso não salvo será perdido!`)===!0?new vt(s.documentId,0,s.nodeImageList):null}class os{constructor(t){l(this,"_keyboard");this._keyboard=t}onKeyDown(t){this._keyboard.nKeysPressed!==0&&(this._keyboard.keyPressed?this._keyboard.keyHold=!0:(this._keyboard.keyPressed=!0,this._keyboard.keyHold=!1),this._keyboard.keyHold||this.handleKeyPressed(t))}handleKeyPressed(t){const e=this._keyboard.getKeysPressed();e.a||e.A?t.node(v.G_AND):e.d||e.D?t.node(v.G_NAND):e.r||e.R?t.node(v.G_NOR):e.n||e.N?t.node(v.G_NOT):e.o||e.O?t.node(v.G_OR):e.v||e.V?t.node(v.G_XNOR):e.x||e.X?t.node(v.G_XOR):e.s||e.S?t.input(v.I_SWITCH):e.l||e.L?t.output(v.O_LED_RED):e.Delete?t.remove():e.Insert&&ee(t.editorEnv)}onKeyUp(){this._keyboard.keyPressed&&this._keyboard.nKeysPressed===0&&(this._keyboard.keyPressed=!1,this._keyboard.keyHold=!1)}}class rs{constructor(){l(this,"keys",{});l(this,"keyPressed",!1);l(this,"keyHold",!1);l(this,"stateChange",!1);l(this,"_nKeysPressed",0)}get nKeysPressed(){return this._nKeysPressed}set nKeysPressed(t){t<0&&console.warn("Número de teclas pressionadas é menor que 0!"),this._nKeysPressed=Math.max(0,t)}setKeyPressed(t,e){this.keys[t]=e,this.nKeysPressed+=e?1:-1}getKeysPressed(){return this.keys}}const as="modulepreload",ls=function(s){return"/"+s},qt={},V=function(t,e,n){let i=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),a=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));i=Promise.allSettled(e.map(h=>{if(h=ls(h),h in qt)return;qt[h]=!0;const f=h.endsWith(".css"),u=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${u}`))return;const d=document.createElement("link");if(d.rel=f?"stylesheet":as,f||(d.as="script"),d.crossOrigin="",d.href=h,a&&d.setAttribute("nonce",a),document.head.appendChild(d),f)return new Promise((g,p)=>{d.addEventListener("load",g),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(r){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=r,window.dispatchEvent(a),!a.defaultPrevented)throw r}return i.then(r=>{for(const a of r||[])a.status==="rejected"&&o(a.reason);return t().catch(o)})},cs=Object.assign({"/src/assets/gates/AND_ANSI.svg":()=>V(()=>import("./AND_ANSI-CEWkG20K.js"),[]),"/src/assets/gates/INPUT_OFF.svg":()=>V(()=>import("./INPUT_OFF-CfLPdNrM.js"),[]),"/src/assets/gates/INPUT_ON.svg":()=>V(()=>import("./INPUT_ON-BG85N5Au.js"),[]),"/src/assets/gates/LED_OFF.svg":()=>V(()=>import("./LED_OFF-DNjMqzNq.js"),[]),"/src/assets/gates/LED_RED_ON.svg":()=>V(()=>import("./LED_RED_ON-Gfn-62pG.js"),[]),"/src/assets/gates/NAND_ANSI.svg":()=>V(()=>import("./NAND_ANSI-zuTdRKxX.js"),[]),"/src/assets/gates/NOR_ANSI.svg":()=>V(()=>import("./NOR_ANSI-cJ4CU1Vs.js"),[]),"/src/assets/gates/NOT_ANSI.svg":()=>V(()=>import("./NOT_ANSI-C4xqBejG.js"),[]),"/src/assets/gates/OR_ANSI.svg":()=>V(()=>import("./OR_ANSI-y1g9LxSV.js"),[]),"/src/assets/gates/XNOR_ANSI.svg":()=>V(()=>import("./XNOR_ANSI-CxZmI0ES.js"),[]),"/src/assets/gates/XOR_ANSI.svg":()=>V(()=>import("./XOR_ANSI-CzAd2DtK.js"),[])});function hs(){const s={};for(const t in cs)Ne(t).then(e=>s[t]=e);return s}function ds(s,t,e){var n,i,o,r;if(!window){console.error("Variável window é nula! Não será possível iniciar o editor");return}window.onload=()=>{s.resize(),setInterval(s.compute,1e3/s.tickRate),s.update(),setTimeout(()=>{document.getElementById("app").style.visibility="visible",document.getElementById("app-toolbar").style.visibility="visible",document.getElementById("app").className="animate-show",document.getElementById("app-toolbar").className="animate-show",document.getElementById("loading-div").style.visibility="hidden"},1e3)},window.onresize=()=>s.resize(),t.onmousedown=()=>s.mouse.clicked=!0,t.onmouseup=t.onmouseout=()=>s.mouse.clicked=!1,window.onmousemove=({x:a,y:h})=>s.setLocalMousePosition(a,h),window.onkeydown=a=>s.keyboard.setKeyPressed(a.key,!0),window.onkeyup=a=>s.keyboard.setKeyPressed(a.key,!1),(n=document.getElementById("save-editor"))==null||n.addEventListener("click",()=>ee(s.editorEnv)),(i=document.getElementById("load-editor"))==null||i.addEventListener("click",()=>{var a;(a=document.getElementById("load-editor-file"))==null||a.click()}),(o=document.getElementById("load-editor-file"))==null||o.addEventListener("change",a=>ns(s,s.canvasCtx,a)),(r=document.getElementById("clear-editor"))==null||r.addEventListener("click",()=>{s.editorEnv=is(s.editorEnv)??s.editorEnv})}class us{constructor(t,e,n,i=60){l(this,"editorEnv");l(this,"mouse");l(this,"keyboard");l(this,"mouseEvents");l(this,"keyboardEvents");l(this,"canvasId");l(this,"canvasCtx");l(this,"backgroundCtx");l(this,"backgroundPattern");l(this,"windowResized");l(this,"tickRate");l(this,"update",()=>{re(this.canvasCtx,this.editorEnv.components),this.windowResized&&(ae(this.backgroundCtx,this.backgroundPattern),this.windowResized=!1),requestAnimationFrame(this.update)});l(this,"compute",()=>{this.keyboardEvents.onKeyDown(this),this.keyboardEvents.onKeyUp(),this.mouseEvents.onMouseClick(this.editorEnv),this.mouseEvents.onMouseMove(this.editorEnv),this.mouseEvents.onMouseRelease(this.editorEnv)});this.editorEnv=new vt(t,0,hs()),this.mouse=new Me,this.keyboard=new rs,this.mouseEvents=new De(this.mouse),this.keyboardEvents=new os(this.keyboard);const o=document.getElementById(e),r=document.getElementById(n);this.canvasId=e,this.canvasCtx=this.createContext(o),this.backgroundCtx=this.createContext(r),this.backgroundPattern=null,this.loadBackgroundPattern(ie),this.windowResized=!0,this.tickRate=i,ds(this,o)}createContext(t){return t.getContext("2d",{desynchronized:!0})}loadBackgroundPattern(t){const e=new Image;e.onload=()=>{this.backgroundPattern=this.backgroundCtx.createPattern(e,"repeat")},e.src=t}getEditorArea(){var n;const t=(n=document.getElementById(this.canvasId))==null?void 0:n.parentElement,e=new c(0,0,!1);if(t){const i=window.getComputedStyle(t);e.x=parseFloat(i.width.substring(0,i.length-2)),e.y=parseFloat(i.height.substring(0,i.length-2))}else e.x=window.innerWidth,e.y=window.innerHeight;return e}setLocalMousePosition(t,e){const n=this.canvasCtx.canvas.getBoundingClientRect();this.mouse.position=new c(t-n.left,e-n.top)}resize(){const t=this.getEditorArea();this.canvasCtx.canvas.width=t.x,this.canvasCtx.canvas.height=t.y,this.backgroundCtx.canvas.width=t.x,this.backgroundCtx.canvas.height=t.y,this.windowResized=!0}node(t=v.G_AND,e=this.mouse.position.x,n=this.mouse.position.y){return J.node(void 0,this.editorEnv,this.canvasCtx.canvas.width,this.canvasCtx.canvas.height,t,e,n)}input(t=v.I_SWITCH,e=this.mouse.position.x,n=this.mouse.position.y){return J.input(void 0,this.editorEnv,this.canvasCtx.canvas.width,this.canvasCtx.canvas.height,t,e,n)}output(t=v.O_LED_RED,e=this.mouse.position.x,n=this.mouse.position.y){return J.output(void 0,this.editorEnv,this.canvasCtx.canvas.width,this.canvasCtx.canvas.height,t,e,n)}line(t,e,n,i,o,r){return J.connection(void 0,this.editorEnv,t,e,n,i,o,r)}text(t,e,n,i,o){return J.text(void 0,this.editorEnv,this.canvasCtx,t,e,n,i,o)}slot(t,e,n,i,o,r,a,h){return J.slot(void 0,this.editorEnv,t,e,n,i,o,r,a,h)}remove(){return this.mouseEvents.getCollisionList().nodes.length!==0?this.editorEnv.removeComponent(this.mouseEvents.getCollisionList().nodes[0]):this.mouseEvents.getCollisionList().connections.length!==0?this.editorEnv.removeComponent(this.mouseEvents.getCollisionList().connections[0]):this.mouseEvents.getCollisionList().texts.length!==0?this.editorEnv.removeComponent(this.mouseEvents.getCollisionList().texts[0]):!1}}const fs=new us("teste","editor-canvas","editor-background");fs.text("Olá mundo",500,200,"32px sans-serif");
